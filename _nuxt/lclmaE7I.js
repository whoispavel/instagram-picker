import{ak as M,G as v,a1 as q,H as f,u as N,c as g,b as u,j as c,k as y,z as d,a as k,i as b,t as h,P as G,o as m,E as _,C as U}from"./rUxWeFGW.js";import{u as A}from"./IrCqCeJw.js";import{F as P,a as C,b as I,S as T,W as R,c as F,d as O,D as S}from"./CvT78Spi.js";import{i as W}from"./BzTPqjsj.js";import{p as $,w as B}from"./CxKpLf07.js";import"./DysYrq2t.js";import"./11RS6YOe.js";import"./CqxP3l68.js";import"./Dm9fix82.js";const D={class:"section section-white free-tool-section"},E={class:"container"},H={key:0},V={class:"progress-bar-content"},J={key:1,class:"text-danger text-center"},j={key:1},Y={key:2},Q={class:"winner-header"},z=u("br",null,null,-1),K={name:"giveaway",components:{ProgressBar:$,FreeToolScannerInput:I,SweepTakes:T,FreeToolsSteps:P,FreeToolHeader:C,FreeToolInformation:F,InstagramPost:W,WinnerPersonCard:B,FreeToolModals:O,Determining:S,WinnerResults:R},data(){return{step:1,url:"",minimumMention:1,NumberOfWinner:1,res_error:0,response:{post_img:"",count:null,likes:null,comments:[],caption:null,user_name:""},comments:[],unique_comments:[],winners:[],is_limited:!0,loading:!1,share_url_error:!1,share_url_error_message:"",temp_url:""}},mounted(){this.checkDailyLimit(),this.checkQueryParams()},methods:{sleep:function(t){return new Promise(o=>setTimeout(o,t))},fetchComments:async function(){let t=_(),o=0;const a=async()=>{try{const{data:n,status:s,message:i,error:l}=await $fetch(t.public.API_URL+"giveaway/v2/check",{method:"POST",body:JSON.stringify({token:this.post_token})});if(s){if(!n.progress)for(let e=0;e<n.winners.length;e++)this.winners.push({image:n.winners[e].avatar,username:n.winners[e].username});return!0}else return!1}catch{}};await(async()=>{for(;o<60;){try{let n=await a();n&&this.winners.length===0?o++:!n&&this.winners.length===0?o=o+12:o=60}catch(n){console.warn(n)}await this.sleep(2e3)}})()},fetchWinners:async function(t){let o=_();try{let{data:a,status:r}=await $fetch(o.public.API_URL+"giveaway/v2/options",{method:"PUT",body:JSON.stringify({minimum_mention:t.mention,number_of_winner:t.winners>=50?this.commentCount<=50?this.commentCount:49:t.winners>this.commentCount?this.commentCount:t.winners,token:this.post_token})});if(r&&!a.progress)for(let n=0;n<a.winners.length;n++)this.winners.push({image:a.winners[n].avatar,username:a.winners[n].username});return r}catch(a){return console.warn(a),!1}},findWinners:async function(){try{this.loading=!0;let[t]=await Promise.all([this.fetchWinners({mention:this.minimumMention,winners:this.NumberOfWinner,token:this.post_token})]);this.isGiveawayComplete=t,this.winners.length>0&&this.isGiveawayComplete?(this.loading=!1,this.step=3,await this.setCookie()):(this.url="",this.temp_url="",this.loading=!1,this.response={post_img:"",count:null,likes:null,comments:[],caption:null,user_name:""},this.share_url_error=!1,this.share_url_error_message="",this.winners=[],this.step=1)}catch(t){console.warn(t)}finally{this.comments=[]}try{window.dataLayer.push({event:"giveaway-instagram_success_web"})}catch(t){console.warn("GTM warn: ",t)}},scanInstagramPost:async function(t){let o=_();if(this.share_url_error=!1,this.temp_url="",this.url.indexOf("https://www.facebook")!==-1)return this.showPlatformModal("facebook"),!1;if(this.url.indexOf("https://www.youtube")!==-1)return this.showPlatformModal("youtube"),!1;if(this.url.indexOf("https://www.x")!==-1||this.url.indexOf("https://x")!==-1)return this.showPlatformModal("twitter"),!1;if(this.url.indexOf("https://www.tiktok")!==-1)return this.showPlatformModal("tiktok"),!1;if(!t&&(t||this.loading))return;this.loading=!0;let a=await this.getCookie("utm_campaign")||null,r=await this.getCookie("utm_source")||null;const n=async()=>{try{let i={post_url:this.url};r&&(i.utm_source=r),a&&(i.utm_campaign=a);const{data:l,status:e}=await $fetch(o.public.API_URL+"giveaway/v2/start",{method:"POST",body:JSON.stringify(i)},!1);return l}catch(i){throw i}},s=async()=>{let i=0;for(;i<15;)try{let l=await n();if(l.details.comment_count){if(l.details)return this.commentCount=l.details.comment_count,l;i++}else return i=15,this.empty_comment=!0,l}catch{i++}throw new Error(`Failed to fetch data from ${url} after 15 attempts`)};try{const[i]=await Promise.all([s()]);this.response={caption:i.details.post_caption,count:i.details.comment_count,post_img:i.details.post_img,likes:i.details.like_count,username:i.details.owner.username},this.post_token=i.token,this.step=2,this.loading=!1}catch{console.warn("can't load comments"),this.loading=!1}},checkDailyLimit:function(){this.is_limited=this.getCookie("ig")!=="1"},setCookie:async function(){let t=new Date;t.setTime(t.getTime()+24*3600*1e3),document.cookie="ig_giveaway_username="+this.response.user_name+";domain=.wask.co;expires="+t*30+";",document.cookie="ig=1; expires="+t+";",document.cookie="use_made_giveaway=IG_GIVEAWAY;domain=.wask.co;expires="+t*30+";"},getCookie:function(t){let o=t+"=",r=decodeURIComponent(document.cookie).split(";");for(let n=0;n<r.length;n++){let s=r[n];for(;s.charAt(0)===" ";)s=s.substring(1);if(s.indexOf(o)===0)return s.substring(o.length,s.length)}return""},loginRequest:function(){this.$refs.modals.login=!0},registerRequest:function(){this.$refs.modals.register=!0},checkQueryParams:function(){let t=(this._.provides[G]||this.$route).query.scan_url;t&&(this.url=t,this.scanInstagramPost())},showPlatformModal:function(t){this.$refs.modals[t]=!0,this.$refs.modals.scan_url=this.url}},watch:{step:function(t){t===2&&window.scrollTo({top:0,behavior:"smooth"})},loading:function(){window.scrollTo({top:0,behavior:"smooth"})}}},ae=Object.assign(K,{async setup(t){let o,a;const r=M("lang");r.value=r.value||"en";const{setLocale:n}=v(),s=v();let l=q().query.lang;return l?([o,a]=f(()=>n(l)),await o,a(),r.value=l):([o,a]=f(()=>n(r.value)),await o,a()),s.locale.value==="en"||s.locale.value==="de"||s.locale.value==="es"||s.locale.value==="fr"||s.locale.value==="ru"||s.locale.value==="tr"||([o,a]=f(()=>n("en")),await o,a()),A({title:s.t("Free Instagram Comment Picker and Giveaways Tool"),description:s.t("instagram-giveaway-desc"),"og:title":s.t("Free Instagram Comment Picker and Giveaways Tool"),"og:description":s.t("instagram-giveaway-desc"),keywords:s.t("instagram-giveaway-keywords")}),N({script:[{type:"application/ld+json",innerHTML:JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"WASK",item:"https://www.wask.co"},{"@type":"ListItem",position:2,name:s.t("Free Instagram Comment Picker and Giveaways Tool"),item:"https://www.wask.co/instagram-giveaway-comment-winner-picker"+(s.locale.value==="en"?"":"?lang="+s.locale.value)}]})}],htmlAttrs:{lang:s.locale},link:[{rel:"canonical",href:"https://www.wask.co/instagram-giveaway-comment-winner-picker"}],meta:[{name:"og:url",content:"https://www.wask.co/instagram-giveaway-comment-winner-picker"+(s.locale.value==="en"?"":"?lang="+s.locale.value)},{name:"og:image",content:"https://www.wask.co/og-image.png"}]}),(e,w)=>{const L=U;return m(),g("div",D,[u("div",E,[c(P,{step:e.step},null,8,["step"]),e.step===1?(m(),g("div",H,[c(C,null,{default:y(()=>[u("h1",null,h(e.$t("Free Instagram Comment Picker and Giveaways Tool")),1),u("p",null,h(e.$t("You can start the sweepstakes by copying the url of the instagram sweepstakes post below")),1),c(L,{src:"/img/free-tool/instagram-logo.svg",width:"50",height:"50",alt:"instagram"})]),_:1}),e.loading?(m(),d($,{key:0,class:"mb-3"},{default:y(()=>[u("div",V,h(e.$t("Getting your comments... Please wait!")),1)]),_:1})):k("",!0),c(I,{url:e.url,"onUpdate:url":w[0]||(w[0]=p=>e.url=p),onScanForUrl:e.scanInstagramPost,placeholder:"Enter Your Instagram Post Url"},null,8,["url","onScanForUrl"]),e.share_url_error&&e.temp_url===e.url?(m(),g("h2",J," Incorrect post link. Please check again. ")):k("",!0)])):e.step===2?(m(),g("div",j,[e.loading?(m(),d(S,{key:1})):(m(),d(T,{key:0,"minimum-mention":e.minimumMention,"onUpdate:minimumMention":w[1]||(w[1]=p=>e.minimumMention=p),"number-of-winner":e.NumberOfWinner,"onUpdate:numberOfWinner":w[2]||(w[2]=p=>e.NumberOfWinner=p),comments:e.response.count,onFindWinners:e.findWinners},null,8,["minimum-mention","number-of-winner","comments","onFindWinners"]))])):(m(),g("div",Y,[u("h3",Q,[b(h(e.$t("Congratulations!"))+" ",1),z,b(" "+h(e.$t("Here are the winners")),1)]),c(W,{username:e.response.username,content:e.response.caption,likes:e.response.likes,comment:e.response.count,image:e.response.post_img},null,8,["username","content","likes","comment","image"]),c(R,{type:"instagram",winners:e.winners,"show-first":e.is_limited,onLoginRequest:e.loginRequest,onRegisterRequest:e.registerRequest},null,8,["winners","show-first","onLoginRequest","onRegisterRequest"])])),e.step===1?(m(),d(F,{key:3},{default:y(()=>[u("p",null,h(e.$t("free-tool-information-paragraph-1")),1),u("p",null,h(e.$t("free-tool-information-paragraph-2")),1)]),_:1})):k("",!0),c(O,{ref:"modals"},null,512)])])}}});export{ae as default};
