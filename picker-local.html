<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Instagram Comment Picker - –ü–æ–≤–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --card: #141b2e;
    --card-hover: #1a2238;
    --border: #1f2847;
    --text: #e9ecf1;
    --text-muted: #8b93a7;
    --accent: #20d09c;
    --accent-hover: #1ab885;
    --danger: #ef4444;
    --warning: #f59e0b;
    --step-active: #20d09c;
    --step-inactive: #2d3548;
  }
  
  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    font-family: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  
  /* Header */
  .header {
    text-align: center;
    padding: 40px 20px 30px;
  }
  
  .logo {
    font-size: 28px;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 10px;
  }
  
  h1 {
    font-size: clamp(24px, 5vw, 38px);
    margin: 20px 0 10px;
    line-height: 1.2;
  }
  
  .subtitle {
    color: var(--text-muted);
    font-size: 16px;
    max-width: 600px;
    margin: 0 auto;
  }
  
  /* Steps */
  .steps {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin: 40px 0;
    flex-wrap: wrap;
  }
  
  .step {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 24px;
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 16px;
    transition: all 0.3s;
    min-width: 200px;
  }
  
  .step.active {
    border-color: var(--step-active);
    background: var(--card-hover);
    box-shadow: 0 0 20px rgba(32, 208, 156, 0.2);
  }
  
  .step-num {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--step-inactive);
    color: var(--text);
    display: grid;
    place-items: center;
    font-weight: 700;
    font-size: 18px;
    transition: all 0.3s;
  }
  
  .step.active .step-num {
    background: var(--step-active);
    color: #000;
  }
  
  .step-label {
    font-weight: 600;
    font-size: 15px;
  }
  
  /* Card */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 32px;
    margin: 24px 0;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }
  
  /* Input Section */
  .input-section {
    max-width: 700px;
    margin: 0 auto;
  }
  
  .input-group {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 20px;
  }
  
  input[type="url"] {
    flex: 1 1 400px;
    padding: 16px 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: #0e1426;
    color: var(--text);
    font-size: 15px;
    outline: none;
    transition: border-color 0.3s;
  }
  
  input[type="url"]:focus {
    border-color: var(--accent);
  }
  
  input[type="url"]::placeholder {
    color: #6b7280;
  }
  
  .btn {
    padding: 16px 32px;
    border: none;
    border-radius: 12px;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .btn-primary {
    background: var(--accent);
    color: #000;
  }
  
  .btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(32, 208, 156, 0.3);
  }
  
  .btn-danger {
    background: var(--danger);
    color: white;
  }
  
  .btn-secondary {
    background: var(--card-hover);
    color: var(--text);
    border: 1px solid var(--border);
  }
  
  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
  }
  
  /* Comments Section */
  .comments-section {
    display: none;
  }
  
  .comments-section.active {
    display: block;
  }
  
  .stats {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    margin: 20px 0;
  }
  
  .stat-card {
    flex: 1;
    min-width: 160px;
    padding: 20px;
    background: #0e1426;
    border-radius: 12px;
    border: 1px solid var(--border);
  }
  
  .stat-label {
    color: var(--text-muted);
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--accent);
    margin-top: 8px;
  }
  
  /* Filters */
  .filters {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin: 20px 0;
  }
  
  .filter-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: #0e1426;
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .filter-checkbox:hover {
    border-color: var(--accent);
  }
  
  .filter-checkbox input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  
  /* Comments List */
  .comments-list {
    max-height: 400px;
    overflow-y: auto;
    margin: 20px 0;
  }
  
  .comment-item {
    display: flex;
    align-items: start;
    gap: 12px;
    padding: 16px;
    background: #0e1426;
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 12px;
    transition: all 0.3s;
  }
  
  .comment-item:hover {
    border-color: var(--accent);
    transform: translateX(4px);
  }
  
  .comment-item.filtered {
    opacity: 0.4;
  }
  
  .comment-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: grid;
    place-items: center;
    color: white;
    font-weight: 700;
    flex-shrink: 0;
  }
  
  .comment-content {
    flex: 1;
  }
  
  .comment-username {
    font-weight: 600;
    color: var(--text);
    margin-bottom: 4px;
  }
  
  .comment-text {
    color: var(--text-muted);
    font-size: 14px;
  }
  
  .comment-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    margin-left: 8px;
  }
  
  .badge-duplicate {
    background: var(--warning);
    color: #000;
  }
  
  /* Winner Section */
  .winner-section {
    display: none;
    text-align: center;
  }
  
  .winner-section.active {
    display: block;
  }
  
  .winner-animation {
    margin: 40px 0;
    padding: 40px;
    background: linear-gradient(135deg, rgba(32, 208, 156, 0.1) 0%, rgba(32, 208, 156, 0.05) 100%);
    border: 2px dashed var(--accent);
    border-radius: 20px;
  }
  
  .winner-card {
    display: inline-block;
    padding: 32px 48px;
    background: var(--card-hover);
    border: 2px solid var(--accent);
    border-radius: 16px;
    box-shadow: 0 12px 32px rgba(32, 208, 156, 0.3);
    animation: winnerPulse 2s ease-in-out;
  }
  
  @keyframes winnerPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
  
  .winner-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: grid;
    place-items: center;
    color: white;
    font-weight: 700;
    font-size: 48px;
    margin: 0 auto 20px;
    border: 4px solid var(--accent);
  }
  
  .winner-username {
    font-size: 32px;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 12px;
  }
  
  .winner-comment {
    color: var(--text-muted);
    font-size: 16px;
    max-width: 400px;
    margin: 0 auto;
  }
  
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: var(--accent);
    animation: confettiFall 3s ease-out forwards;
    pointer-events: none;
  }
  
  @keyframes confettiFall {
    to {
      transform: translateY(100vh) rotate(360deg);
      opacity: 0;
    }
  }
  
  .actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 24px;
    flex-wrap: wrap;
  }
  
  .hidden {
    display: none !important;
  }
  
  /* Loading spinner */
  .spinner {
    border: 3px solid var(--border);
    border-top: 3px solid var(--accent);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: var(--card);
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: var(--accent);
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">üéÅ WASK Comment Picker</div>
      <h1>–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–æ–∑—ñ–≥—Ä–∞—à—ñ–≤ —É Instagram</h1>
      <p class="subtitle">–í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ—Å—Ç –∑ –∫–æ–Ω–∫—É—Ä—Å–æ–º —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á—Ç–µ –ø–µ—Ä–µ–º–æ–∂—Ü—è</p>
    </div>

    <!-- Steps -->
    <div class="steps">
      <div class="step active" id="step1">
        <div class="step-num">1</div>
        <div class="step-label">–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ—Å—Ç–∞</div>
      </div>
      <div class="step" id="step2">
        <div class="step-num">2</div>
        <div class="step-label">–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —É—á–∞—Å–Ω–∏–∫—ñ–≤</div>
      </div>
      <div class="step" id="step3">
        <div class="step-num">3</div>
        <div class="step-label">–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä–µ–º–æ–∂—Ü—è</div>
      </div>
    </div>

    <!-- Step 1: URL Input -->
    <div class="card input-section" id="inputSection">
      <div class="input-group">
        <input 
          type="url" 
          id="postUrl" 
          placeholder="https://www.instagram.com/p/..." 
          autocomplete="off"
        >
        <button class="btn btn-primary" id="scanBtn">
          <span>üîç</span>
          <span>–°–ö–ê–ù–£–í–ê–¢–ò</span>
        </button>
      </div>
      
      <div style="text-align: center; margin: 20px 0; color: var(--text-muted);">
        –∞–±–æ
      </div>
      
      <div style="text-align: center;">
        <button class="btn btn-secondary" id="manualImportBtn">
          üìã –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –≤—Ä—É—á–Ω—É
        </button>
      </div>
    </div>
    
    <!-- Manual Import Modal -->
    <div id="importModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: none; align-items: center; justify-content: center;">
      <div class="card" style="max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
        <h2 style="margin-bottom: 16px;">üìã –†—É—á–Ω–∏–π —ñ–º–ø–æ—Ä—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤</h2>
        <p style="color: var(--text-muted); margin-bottom: 16px;">
          –í—Å—Ç–∞–≤—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ —É —Ñ–æ—Ä–º–∞—Ç—ñ:<br>
          <code style="background: #0e1426; padding: 4px 8px; border-radius: 4px;">@username: —Ç–µ–∫—Å—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—è</code>
        </p>
        <textarea 
          id="manualCommentsInput" 
          style="width: 100%; min-height: 300px; padding: 16px; background: #0e1426; border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: monospace; resize: vertical;"
          placeholder="@anna_fitness: –•–æ—á—É –≤–∏–≥—Ä–∞—Ç–∏! üéâ&#10;@max_developer: –ß—É–¥–æ–≤–∏–π —Ä–æ–∑—ñ–≥—Ä–∞—à!&#10;@olena_travel: –ú—Ä—ñ—é –ø—Ä–æ —Ü–µ–π –ø—Ä–∏–∑"
        ></textarea>
        <div style="display: flex; gap: 12px; margin-top: 16px;">
          <button class="btn btn-primary" id="importCommentsBtn">‚úÖ –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏</button>
          <button class="btn btn-secondary" id="closeModalBtn">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
      </div>
    </div>

    <!-- Step 2: Comments & Filters -->
    <div class="card comments-section" id="commentsSection">
      <h2 style="margin-bottom: 20px;">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è</h2>
      
      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">–í—Å—å–æ–≥–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤</div>
          <div class="stat-value" id="totalComments">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–£–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤</div>
          <div class="stat-value" id="uniqueParticipants">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–æ</div>
          <div class="stat-value" id="filteredCount">0</div>
        </div>
      </div>

      <h3 style="margin: 24px 0 12px;">‚öôÔ∏è –§—ñ–ª—å—Ç—Ä–∏</h3>
      <div class="filters">
        <label class="filter-checkbox">
          <input type="checkbox" id="filterDuplicates" checked>
          <span>–í–∏–¥–∞–ª–∏—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</span>
        </label>
        <label class="filter-checkbox">
          <input type="checkbox" id="filterTags">
          <span>–¢—ñ–ª—å–∫–∏ –∑ —Ç–µ–≥–∞–º–∏ –¥—Ä—É–∑—ñ–≤</span>
        </label>
      </div>

      <h3 style="margin: 24px 0 12px;">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ —É—á–∞—Å–Ω–∏–∫—ñ–≤</h3>
      <div class="comments-list" id="commentsList"></div>

      <div class="actions">
        <button class="btn btn-primary" id="selectWinnerBtn">
          üéâ –í–ò–ë–†–ê–¢–ò –ü–ï–†–ï–ú–û–ñ–¶–Ø
        </button>
        <button class="btn btn-secondary" id="resetBtn">
          üîÑ –ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ
        </button>
      </div>
    </div>

    <!-- Step 3: Winner -->
    <div class="card winner-section" id="winnerSection">
      <h2 style="margin-bottom: 20px;">üéä –ü–µ—Ä–µ–º–æ–∂–µ—Ü—å –≤–∏–∑–Ω–∞—á–µ–Ω–æ!</h2>
      
      <div class="winner-animation">
        <div class="winner-card" id="winnerCard">
          <div class="winner-avatar" id="winnerAvatar"></div>
          <div class="winner-username" id="winnerUsername"></div>
          <div class="winner-comment" id="winnerComment"></div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-primary" id="selectAnotherBtn">
          üé≤ –í–∏–±—Ä–∞—Ç–∏ —ñ–Ω—à–æ–≥–æ
        </button>
        <button class="btn btn-secondary" id="newGiveawayBtn">
          ‚ú® –ù–æ–≤–∏–π —Ä–æ–∑—ñ–≥—Ä–∞—à
        </button>
      </div>
    </div>
  </div>

  <!-- Instagram API Integration -->
  <script src="instagram-api.js"></script>
  
  <script>
    // Demo data - —ñ–º—ñ—Ç–∞—Ü—ñ—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –∑ Instagram
    const DEMO_COMMENTS = [
      { username: 'anna_fitness', text: '–•–æ—á—É –≤–∏–≥—Ä–∞—Ç–∏! üéâ @maria_yoga', avatar: 'A', hasTags: true },
      { username: 'max_developer', text: '–ß—É–¥–æ–≤–∏–π —Ä–æ–∑—ñ–≥—Ä–∞—à!', avatar: 'M', hasTags: false },
      { username: 'olena_travel', text: '–ú—Ä—ñ—é –ø—Ä–æ —Ü–µ–π –ø—Ä–∏–∑ @ivan_photo @kate_blogger', avatar: 'O', hasTags: true },
      { username: 'dmytro_music', text: '–°—É–ø–µ—Ä! üî•', avatar: 'D', hasTags: false },
      { username: 'sofia_art', text: '–£—á–∞—Å—Ç—å –±–µ—Ä—É! @nick_design', avatar: 'S', hasTags: true },
      { username: 'ivan_photo', text: '–¢—Ä–∏–º–∞—é –∫—É–ª–∞—á–∫–∏ ü§û', avatar: 'I', hasTags: false },
      { username: 'kate_blogger', text: '–•–æ—á—É –≤–∏–≥—Ä–∞—Ç–∏ @anna_fitness', avatar: 'K', hasTags: true },
      { username: 'petro_chef', text: '–ö–ª–∞—Å–Ω–∏–π –∫–æ–Ω–∫—É—Ä—Å!', avatar: 'P', hasTags: false },
      { username: 'maria_yoga', text: '–ë–µ—Ä—É —É—á–∞—Å—Ç—å! üí™', avatar: 'M', hasTags: false },
      { username: 'anna_fitness', text: '–©–µ —Ä–∞–∑ –ø—Ä–æ–±—É—é —â–∞—Å—Ç—è!', avatar: 'A', hasTags: false },
      { username: 'nick_design', text: '–î—É–∂–µ —Ö–æ—á—É –≤–∏–≥—Ä–∞—Ç–∏ @sofia_art @max_developer', avatar: 'N', hasTags: true },
      { username: 'alina_beauty', text: '–£—á–∞—Å—Ç–≤—É—é! ‚ú®', avatar: 'A', hasTags: false },
      { username: 'sergiy_sport', text: '–ú—ñ–π —à–∞–Ω—Å! @dmytro_music', avatar: 'S', hasTags: true },
      { username: 'yana_style', text: '–•–æ—á—É –≤–∏–≥—Ä–∞—Ç–∏ —Ü–µ–π –ø—Ä–∏–∑! üéÅ', avatar: 'Y', hasTags: false },
      { username: 'viktor_tech', text: '–ö—Ä—É—Ç–æ! @petro_chef @yana_style', avatar: 'V', hasTags: true }
    ];

    // State
    let allComments = [];
    let filteredComments = [];
    let winner = null;
    let useRealAPI = false; // ‚ùå –í–∏–º–∫–Ω–µ–Ω–æ (–ª–æ–∫–∞–ª—å–Ω—ñ –¥–∑–µ—Ä–∫–∞–ª–∞ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å —Å–ø—Ä–∞–≤–∂–Ω—ñ–π Instagram API)
    const API_URL = 'http://localhost:3000'; // –ê–¥—Ä–µ—Å–∞ –±–µ–∫–µ–Ω–¥—É

    // Elements
    const scanBtn = document.getElementById('scanBtn');
    const postUrl = document.getElementById('postUrl');
    const manualImportBtn = document.getElementById('manualImportBtn');
    const importModal = document.getElementById('importModal');
    const manualCommentsInput = document.getElementById('manualCommentsInput');
    const importCommentsBtn = document.getElementById('importCommentsBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const inputSection = document.getElementById('inputSection');
    const commentsSection = document.getElementById('commentsSection');
    const winnerSection = document.getElementById('winnerSection');
    const commentsList = document.getElementById('commentsList');
    const totalComments = document.getElementById('totalComments');
    const uniqueParticipants = document.getElementById('uniqueParticipants');
    const filteredCount = document.getElementById('filteredCount');
    const filterDuplicates = document.getElementById('filterDuplicates');
    const filterTags = document.getElementById('filterTags');
    const selectWinnerBtn = document.getElementById('selectWinnerBtn');
    const selectAnotherBtn = document.getElementById('selectAnotherBtn');
    const resetBtn = document.getElementById('resetBtn');
    const newGiveawayBtn = document.getElementById('newGiveawayBtn');

    // Validation
    function isValidInstagramUrl(url) {
      try {
        const u = new URL(url);
        return u.hostname.includes('instagram.com') && 
               (u.pathname.includes('/p/') || u.pathname.includes('/reel/'));
      } catch {
        return false;
      }
    }

    // Manual Import Modal
    manualImportBtn.addEventListener('click', () => {
      importModal.style.display = 'flex';
    });

    closeModalBtn.addEventListener('click', () => {
      importModal.style.display = 'none';
    });

    importCommentsBtn.addEventListener('click', () => {
      const text = manualCommentsInput.value.trim();
      if (!text) {
        alert('‚ùå –í–≤–µ–¥—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É');
        return;
      }

      try {
        allComments = window.InstagramAPI.parseManualComments(text);
        if (allComments.length === 0) {
          alert('‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–æ—Ä–º–∞—Ç.');
          return;
        }

        importModal.style.display = 'none';
        manualCommentsInput.value = '';
        updateStep(2);
        applyFilters();
      } catch (error) {
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É: ' + error.message);
      }
    });

    // Scan post
    scanBtn.addEventListener('click', async () => {
      const url = postUrl.value.trim();
      
      if (!isValidInstagramUrl(url)) {
        alert('‚ùå –ù–µ–≤–∞–ª—ñ–¥–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ—Å—Ç Instagram.\n–í–∫–∞–∂—ñ—Ç—å URL —Ñ–æ—Ä–º–∞—Ç—É: https://www.instagram.com/p/...');
        return;
      }

      // Show loading
      scanBtn.disabled = true;
      scanBtn.innerHTML = '<div class="spinner"></div><span>–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è...</span>';

      try {
        if (useRealAPI) {
          // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –∑ –±–µ–∫–µ–Ω–¥—É
          try {
            const response = await fetch(`${API_URL}/api/instagram/comments`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ postUrl: url }),
            });

            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.error || '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è');
            }

            if (!data.success) {
              throw new Error(data.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ');
            }

            allComments = data.comments;
            console.log(`‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${data.count} –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ ${data.cached ? '(–∑ –∫–µ—à—É)' : ''}`);

            if (allComments.length === 0) {
              alert('‚ö†Ô∏è –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ.\n\n–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:\n‚Ä¢ –ü–æ—Å—Ç –ø—Ä–∏–≤–∞—Ç–Ω–∏–π\n‚Ä¢ –ù–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤\n‚Ä¢ Instagram –∑–∞–±–ª–æ–∫—É–≤–∞–≤ –¥–æ—Å—Ç—É–ø\n\n–°–ø—Ä–æ–±—É–π—Ç–µ —Ä—É—á–Ω–∏–π —ñ–º–ø–æ—Ä—Ç.');
              return;
            }
          } catch (apiError) {
            console.error('API –ø–æ–º–∏–ª–∫–∞:', apiError);
            alert(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${apiError.message}\n\n–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:\n1. –ß–∏ –∑–∞–ø—É—â–µ–Ω–∏–π –±–µ–∫–µ–Ω–¥ (npm start)\n2. –ß–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π ${API_URL}\n\n–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ä—É—á–Ω–∏–π —ñ–º–ø–æ—Ä—Ç.`);
            return;
          }
        } else {
          // –î–µ–º–æ-—Ä–µ–∂–∏–º
          await new Promise(resolve => setTimeout(resolve, 1500));
          allComments = DEMO_COMMENTS.map(c => ({...c}));
        }
        
        // Move to step 2
        updateStep(2);
        applyFilters();
      } catch (error) {
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ' + error.message);
      } finally {
        scanBtn.disabled = false;
        scanBtn.innerHTML = '<span>üîç</span><span>–°–ö–ê–ù–£–í–ê–¢–ò</span>';
      }
    });

    // Apply filters
    function applyFilters() {
      filteredComments = [...allComments];

      // Remove duplicates
      if (filterDuplicates.checked) {
        const seen = new Set();
        filteredComments = filteredComments.filter(c => {
          if (seen.has(c.username)) {
            c.isDuplicate = true;
            return false;
          }
          seen.add(c.username);
          c.isDuplicate = false;
          return true;
        });
      } else {
        filteredComments.forEach(c => c.isDuplicate = false);
      }

      // Filter by tags
      if (filterTags.checked) {
        filteredComments = filteredComments.filter(c => c.hasTags);
      }

      updateStats();
      renderComments();
    }

    filterDuplicates.addEventListener('change', applyFilters);
    filterTags.addEventListener('change', applyFilters);

    // Update stats
    function updateStats() {
      totalComments.textContent = allComments.length;
      const unique = new Set(allComments.map(c => c.username)).size;
      uniqueParticipants.textContent = unique;
      filteredCount.textContent = allComments.length - filteredComments.length;
    }

    // Render comments
    function renderComments() {
      commentsList.innerHTML = allComments.map((comment, idx) => {
        const isFiltered = !filteredComments.includes(comment);
        return `
          <div class="comment-item ${isFiltered ? 'filtered' : ''}">
            <div class="comment-avatar">${comment.avatar}</div>
            <div class="comment-content">
              <div class="comment-username">
                @${comment.username}
                ${comment.isDuplicate ? '<span class="comment-badge badge-duplicate">–î–£–ë–õ–Ü–ö–ê–¢</span>' : ''}
              </div>
              <div class="comment-text">${comment.text}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Select winner
    selectWinnerBtn.addEventListener('click', selectWinner);
    selectAnotherBtn.addEventListener('click', selectWinner);

    async function selectWinner() {
      if (filteredComments.length === 0) {
        alert('‚ùå –ù–µ–º–∞—î —É—á–∞—Å–Ω–∏–∫—ñ–≤ –¥–ª—è –≤–∏–±–æ—Ä—É. –ó–º—ñ–Ω—ñ—Ç—å —Ñ—ñ–ª—å—Ç—Ä–∏.');
        return;
      }

      selectWinnerBtn.disabled = true;
      selectWinnerBtn.innerHTML = '<div class="spinner"></div><span>–í–∏–±–∏—Ä–∞—î–º–æ...</span>';

      // Random selection with animation
      await new Promise(resolve => setTimeout(resolve, 1000));

      winner = filteredComments[Math.floor(Math.random() * filteredComments.length)];
      
      // Show winner
      updateStep(3);
      displayWinner(winner);
      createConfetti();

      selectWinnerBtn.disabled = false;
      selectWinnerBtn.innerHTML = 'üéâ –í–ò–ë–†–ê–¢–ò –ü–ï–†–ï–ú–û–ñ–¶–Ø';
    }

    // Display winner
    function displayWinner(winner) {
      document.getElementById('winnerAvatar').textContent = winner.avatar;
      document.getElementById('winnerUsername').textContent = '@' + winner.username;
      document.getElementById('winnerComment').textContent = winner.text;
    }

    // Confetti effect
    function createConfetti() {
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.background = ['#20d09c', '#667eea', '#f59e0b', '#ef4444'][Math.floor(Math.random() * 4)];
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
      }
    }

    // Update step
    function updateStep(step) {
      // Update step indicators
      for (let i = 1; i <= 3; i++) {
        const stepEl = document.getElementById('step' + i);
        if (i <= step) {
          stepEl.classList.add('active');
        } else {
          stepEl.classList.remove('active');
        }
      }

      // Show/hide sections
      inputSection.style.display = step === 1 ? 'block' : 'none';
      commentsSection.classList.toggle('active', step === 2);
      winnerSection.classList.toggle('active', step === 3);
    }

    // Reset
    resetBtn.addEventListener('click', () => {
      if (confirm('–ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ? –ü–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ –±—É–¥—É—Ç—å –≤—Ç—Ä–∞—á–µ–Ω—ñ.')) {
        reset();
      }
    });

    newGiveawayBtn.addEventListener('click', reset);

    function reset() {
      allComments = [];
      filteredComments = [];
      winner = null;
      postUrl.value = '';
      updateStep(1);
    }
  </script>
</body>
</html>
